// Zellij Configuration
// Optimized for Claude Code + Editor workflow with vim keybindings

// =============================================================================
// GENERAL SETTINGS
// =============================================================================

// Use system clipboard
copy_on_select true
scrollback_editor "hx"  // Use helix for scrollback editing (change to nvim if preferred)

// Mouse support
mouse_mode true

// Session behavior
on_force_close "detach"
pane_frames false  // Cleaner look without borders
auto_layout true

// Default shell
default_shell "zsh"

// Default layout when starting zellij without arguments
default_layout "dev"

// Theme - Tokyo Night inspired
theme "tokyo-night"

// =============================================================================
// KEYBINDINGS
// =============================================================================

keybinds clear-defaults=true {
    // -------------------------------------------------------------------------
    // NORMAL MODE - Main navigation
    // -------------------------------------------------------------------------
    normal {
        // Pane navigation (vim style)
        bind "Alt h" { MoveFocus "Left"; }
        bind "Alt l" { MoveFocus "Right"; }
        bind "Alt j" { MoveFocus "Down"; }
        bind "Alt k" { MoveFocus "Up"; }

        // Tab/Workspace navigation
        bind "Alt 1" { GoToTab 1; }
        bind "Alt 2" { GoToTab 2; }
        bind "Alt 3" { GoToTab 3; }
        bind "Alt 4" { GoToTab 4; }
        bind "Alt 5" { GoToTab 5; }
        bind "Alt 6" { GoToTab 6; }
        bind "Alt 7" { GoToTab 7; }
        bind "Alt 8" { GoToTab 8; }
        bind "Alt 9" { GoToTab 9; }

        // Tab management
        bind "Alt n" { NewTab; }
        bind "Alt w" { CloseTab; }
        bind "Alt [" { GoToPreviousTab; }
        bind "Alt ]" { GoToNextTab; }

        // Pane management
        bind "Alt d" { NewPane "Right"; }  // Split right (like Warp)
        bind "Alt D" { NewPane "Down"; }   // Split down
        bind "Alt x" { CloseFocus; }       // Close current pane
        bind "Alt z" { ToggleFocusFullscreen; }  // Zoom pane

        // Resize mode
        bind "Alt r" { SwitchToMode "Resize"; }

        // Pane mode (more pane operations)
        bind "Alt p" { SwitchToMode "Pane"; }

        // Scroll mode
        bind "Alt s" { SwitchToMode "Scroll"; }

        // Session mode
        bind "Alt o" { SwitchToMode "Session"; }

        // Search
        bind "Alt /" { SwitchToMode "EnterSearch"; Search "down"; }

        // Quick actions
        bind "Alt f" { ToggleFloatingPanes; }  // Toggle floating pane (for yazi)
        bind "Alt e" { EditScrollback; }       // Edit scrollback in editor

        // Detach
        bind "Ctrl Alt d" { Detach; }
    }

    // -------------------------------------------------------------------------
    // PANE MODE - Pane operations
    // -------------------------------------------------------------------------
    pane {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "h" { MoveFocus "Left"; }
        bind "l" { MoveFocus "Right"; }
        bind "j" { MoveFocus "Down"; }
        bind "k" { MoveFocus "Up"; }

        // Split
        bind "d" { NewPane "Right"; SwitchToMode "Normal"; }
        bind "D" { NewPane "Down"; SwitchToMode "Normal"; }

        // Move panes
        bind "H" { MovePane "Left"; }
        bind "L" { MovePane "Right"; }
        bind "J" { MovePane "Down"; }
        bind "K" { MovePane "Up"; }

        // Close
        bind "x" { CloseFocus; SwitchToMode "Normal"; }

        // Zoom
        bind "z" { ToggleFocusFullscreen; SwitchToMode "Normal"; }

        // Float
        bind "f" { ToggleFloatingPanes; SwitchToMode "Normal"; }
        bind "w" { TogglePaneEmbedOrFloating; SwitchToMode "Normal"; }

        // Rename
        bind "r" { SwitchToMode "RenamePane"; PaneNameInput 0; }
    }

    // -------------------------------------------------------------------------
    // RESIZE MODE
    // -------------------------------------------------------------------------
    resize {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "h" { Resize "Increase Left"; }
        bind "l" { Resize "Increase Right"; }
        bind "j" { Resize "Increase Down"; }
        bind "k" { Resize "Increase Up"; }
        bind "H" { Resize "Decrease Left"; }
        bind "L" { Resize "Decrease Right"; }
        bind "J" { Resize "Decrease Down"; }
        bind "K" { Resize "Decrease Up"; }
        bind "=" { Resize "Increase"; }
        bind "-" { Resize "Decrease"; }
    }

    // -------------------------------------------------------------------------
    // SCROLL MODE - vim-like scrolling
    // -------------------------------------------------------------------------
    scroll {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "q" { SwitchToMode "Normal"; }
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
        bind "d" { HalfPageScrollDown; }
        bind "u" { HalfPageScrollUp; }
        bind "f" { PageScrollDown; }
        bind "b" { PageScrollUp; }
        bind "g" { ScrollToTop; }
        bind "G" { ScrollToBottom; }
        bind "/" { SwitchToMode "EnterSearch"; Search "down"; }
        bind "?" { SwitchToMode "EnterSearch"; Search "up"; }
        bind "n" { Search "down"; }
        bind "N" { Search "up"; }
        bind "e" { EditScrollback; SwitchToMode "Normal"; }
    }

    // -------------------------------------------------------------------------
    // SEARCH MODE
    // -------------------------------------------------------------------------
    search {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "q" { SwitchToMode "Normal"; }
        bind "Enter" { SwitchToMode "Normal"; }
        bind "n" { Search "down"; }
        bind "N" { Search "up"; }
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
    }

    entersearch {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "Enter" { SwitchToMode "Search"; }
    }

    // -------------------------------------------------------------------------
    // SESSION MODE
    // -------------------------------------------------------------------------
    session {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "d" { Detach; }
        bind "w" {
            LaunchOrFocusPlugin "session-manager" {
                floating true
                move_to_focused_tab true
            };
            SwitchToMode "Normal"
        }
    }

    // -------------------------------------------------------------------------
    // TAB MODE
    // -------------------------------------------------------------------------
    tab {
        bind "Esc" { SwitchToMode "Normal"; }
        bind "h" { GoToPreviousTab; }
        bind "l" { GoToNextTab; }
        bind "n" { NewTab; SwitchToMode "Normal"; }
        bind "x" { CloseTab; SwitchToMode "Normal"; }
        bind "r" { SwitchToMode "RenameTab"; TabNameInput 0; }
        bind "s" { ToggleActiveSyncTab; SwitchToMode "Normal"; }
        bind "1" { GoToTab 1; SwitchToMode "Normal"; }
        bind "2" { GoToTab 2; SwitchToMode "Normal"; }
        bind "3" { GoToTab 3; SwitchToMode "Normal"; }
        bind "4" { GoToTab 4; SwitchToMode "Normal"; }
        bind "5" { GoToTab 5; SwitchToMode "Normal"; }
    }

    renametab {
        bind "Esc" { UndoRenameTab; SwitchToMode "Normal"; }
        bind "Enter" { SwitchToMode "Normal"; }
    }

    renamepane {
        bind "Esc" { UndoRenamePane; SwitchToMode "Normal"; }
        bind "Enter" { SwitchToMode "Normal"; }
    }

    // -------------------------------------------------------------------------
    // SHARED BINDINGS (available in all modes)
    // -------------------------------------------------------------------------
    shared_except "normal" {
        bind "Esc" { SwitchToMode "Normal"; }
    }

    shared_except "locked" {
        // Quick mode switches available everywhere
        bind "Ctrl g" { SwitchToMode "Locked"; }
    }

    locked {
        bind "Ctrl g" { SwitchToMode "Normal"; }
    }
}

// =============================================================================
// THEMES
// =============================================================================

themes {
    tokyo-night {
        fg "#c0caf5"
        bg "#1a1b26"
        black "#15161e"
        red "#f7768e"
        green "#9ece6a"
        yellow "#e0af68"
        blue "#7aa2f7"
        magenta "#bb9af7"
        cyan "#7dcfff"
        white "#a9b1d6"
        orange "#ff9e64"
    }
}

// =============================================================================
// PLUGINS
// =============================================================================

plugins {
    tab-bar location="zellij:tab-bar"
    status-bar location="zellij:status-bar"
    strider location="zellij:strider"
    compact-bar location="zellij:compact-bar"
    session-manager location="zellij:session-manager"
    filepicker location="zellij:strider" {
        cwd "/"
    }
}

// =============================================================================
// UI
// =============================================================================

ui {
    pane_frames {
        hide_session_name true
        rounded_corners true
    }
}
