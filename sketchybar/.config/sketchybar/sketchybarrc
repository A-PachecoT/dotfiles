#!/bin/bash
# HyDE-inspired SketchyBar Configuration
# Using official AeroSpace integration

PLUGIN_DIR="$CONFIG_DIR/plugins"
source "$HOME/.config/sketchybar/themes/tokyo-night"

##### Bar Appearance #####
sketchybar --bar position=top height=32 blur_radius=50 color=$BAR_COLOR \
                 border_width=0 margin=10 corner_radius=12

##### Default Item Properties #####
default=(
  padding_left=8
  padding_right=8
  icon.font="MonoLisa:Bold:14.0"
  label.font="MonoLisa:Medium:12.0" 
  icon.color=$WHITE
  label.color=$WHITE
  icon.padding_left=4
  icon.padding_right=4
  label.padding_left=4
  label.padding_right=4
  background.height=22
  background.corner_radius=8
)
sketchybar --default "${default[@]}"

##### AeroSpace Integration #####
# Add the aerospace workspace change event
sketchybar --add event aerospace_workspace_change

# Add workspace items for occupied workspaces only (Hyprland-style)
# Shows only workspaces with windows + current focused workspace (no duplicates)
for sid in $((aerospace list-workspaces --monitor focused --empty no; aerospace list-workspaces --focused) | sort -u); do
    sketchybar --add item space.$sid left \
        --subscribe space.$sid aerospace_workspace_change \
        --set space.$sid \
        icon.drawing=off \
        label="$sid" \
        label.font="MonoLisa:Bold:14.0" \
        label.color=$WORKSPACE_INACTIVE \
        label.padding_left=8 \
        label.padding_right=8 \
        click_script="aerospace workspace $sid" \
        script="$PLUGIN_DIR/aerospace.sh $sid"
done

# Add spacer after workspaces
sketchybar --add item spacer left \
           --set spacer icon="│" icon.color=$GREY label.drawing=off

# Add current app
sketchybar --add item current_app left \
           --set current_app icon.drawing=off script="$PLUGIN_DIR/front_app.sh" \
           --subscribe current_app front_app_switched

##### Right Side Items #####
sketchybar --add item clock right \
           --set clock icon="󰃰" update_freq=30 script="$PLUGIN_DIR/clock.sh"

##### Initialize #####
sketchybar --update